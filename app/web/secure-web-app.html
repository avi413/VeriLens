<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VeriLens - Secure Photo Authentication</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .badge {
        background: rgba(255, 255, 255, 0.2);
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9rem;
        margin: 0 5px;
        display: inline-block;
      }

      .main-content {
        padding: 30px;
      }

      .security-status {
        background: #f8f9fa;
        border-left: 4px solid #28a745;
        padding: 15px;
        margin-bottom: 30px;
        border-radius: 0 8px 8px 0;
      }

      .security-status.warning {
        border-left-color: #ffc107;
        background: #fff8e1;
      }

      .security-status.error {
        border-left-color: #dc3545;
        background: #ffebee;
      }

      .camera-section {
        margin-bottom: 30px;
      }

      .camera-container {
        position: relative;
        background: #000;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 20px;
      }

      #videoElement {
        width: 100%;
        max-width: 640px;
        height: auto;
        display: block;
      }

      .camera-overlay {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-size: 0.9rem;
      }

      .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .btn-primary {
        background: #3498db;
        color: white;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-warning {
        background: #ffc107;
        color: #212529;
      }

      .btn-info {
        background: #17a2b8;
        color: white;
      }

      .results-section {
        margin-top: 30px;
      }

      .result-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #3498db;
      }

      .result-card.success {
        border-left-color: #28a745;
        background: #f8fff8;
      }

      .result-card.warning {
        border-left-color: #ffc107;
        background: #fffcf0;
      }

      .result-card.error {
        border-left-color: #dc3545;
        background: #fff5f5;
      }

      .trust-score {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin: 20px 0;
      }

      .trust-score.high {
        color: #28a745;
      }
      .trust-score.medium {
        color: #ffc107;
      }
      .trust-score.low {
        color: #dc3545;
      }

      .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .detail-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #e9ecef;
      }

      .detail-item h4 {
        margin-bottom: 8px;
        color: #2c3e50;
      }

      .detail-item p {
        margin: 4px 0;
        font-size: 0.9rem;
        color: #666;
      }

      .status-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-indicator.active {
        background: #28a745;
      }
      .status-indicator.inactive {
        background: #dc3545;
      }
      .status-indicator.warning {
        background: #ffc107;
      }

      .captured-image {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 10px 0;
      }

      .verification-section {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .hash-input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: monospace;
        font-size: 0.9rem;
        margin: 10px 0;
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          border-radius: 10px;
        }

        .header {
          padding: 20px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .main-content {
          padding: 20px;
        }

        .controls {
          flex-direction: column;
        }

        .btn {
          justify-content: center;
        }
      }

      /* Enhanced UI Styles */
      .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn-download {
        background: #28a745;
        color: white;
        font-size: 0.9rem;
      }

      .btn-metadata {
        background: #17a2b8;
        color: white;
        font-size: 0.9rem;
      }

      .btn-copy {
        background: #6c757d;
        color: white;
        font-size: 0.9rem;
      }

      .trust-score-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .sdk-status {
        background: #e9ecef;
        padding: 8px 15px;
        border-radius: 20px;
        font-weight: 500;
        color: #495057;
      }

      .hash-display {
        margin: 10px 0;
      }

      .hash-value {
        font-family: 'Courier New', monospace;
        background: #f8f9fa;
        padding: 10px;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        word-break: break-all;
        font-size: 0.9rem;
        margin-top: 5px;
      }

      .image-container {
        text-align: center;
        margin: 20px 0;
      }

      .captured-image {
        max-width: 100%;
        max-height: 400px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 768px) {
        .result-header {
          flex-direction: column;
          align-items: stretch;
        }

        .action-buttons {
          margin-top: 15px;
          justify-content: center;
        }

        .trust-score-section {
          flex-direction: column;
          gap: 10px;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>üîê VeriLens SDK</h1>
        <p>Secure Photo Authentication with Hardware Attestation</p>
        <div>
          <span class="badge">üõ°Ô∏è Anti-Tampering</span>
          <span class="badge">‚õìÔ∏è Blockchain Verified</span>
          <span class="badge">üì± Hardware Attested</span>
          <span class="badge">üîç Trust Scored</span>
        </div>
      </header>

      <main class="main-content">
        <!-- Security Status -->
        <div id="securityStatus" class="security-status">
          <div id="statusText">üîÑ Initializing VeriLens SDK...</div>
        </div>

        <!-- Camera Section -->
        <section class="camera-section">
          <h2>üì∏ Secure Photo Capture</h2>
          <div class="camera-container">
            <video id="videoElement" autoplay playsinline muted></video>
            <div class="camera-overlay" id="cameraOverlay">
              <div id="overlayText">Camera Inactive</div>
            </div>
          </div>

          <div class="controls">
            <button
              id="startCamera"
              class="btn btn-primary"
              onclick="startSecureCamera()"
            >
              üìπ Start Secure Camera
            </button>
            <button
              id="capturePhoto"
              class="btn btn-success"
              onclick="captureSecurePhoto()"
              disabled
            >
              üì∏ Capture Photo
            </button>
            <button
              id="getStatus"
              class="btn btn-info"
              onclick="getSDKStatus()"
            >
              üìä System Status
            </button>
          </div>
        </section>

        <!-- Results Section -->
        <section
          id="resultsSection"
          class="results-section"
          style="display: none"
        >
          <h2>üìã Capture Results</h2>
          <div id="captureResults"></div>
        </section>

        <!-- Verification Section -->
        <section class="verification-section">
          <h2>üîç Verify Image Hash</h2>
          <p>
            Enter an image hash to verify its authenticity on the blockchain:
          </p>
          <input
            type="text"
            id="hashInput"
            class="hash-input"
            placeholder="Enter SHA-256 hash (64 characters)..."
            maxlength="64"
          />
          <div class="controls">
            <button class="btn btn-primary" onclick="verifyImageHash()">
              üîç Verify Hash
            </button>
          </div>
          <div id="verificationResults" style="display: none"></div>
        </section>
      </main>
    </div>

    <!-- Load Security Services First -->
    <script src="/anti-tampering.js"></script>
    <script src="/device-sensor-service.js"></script>
    <script src="/hardware-attestation.js"></script>
    <script src="/blockchain-service.js"></script>
    <script src="/secure-camera-api.js"></script>

    <!-- Load VeriLens SDK (uses security services) -->
    <script src="/verilens-sdk.js"></script>
    <script src="/verilens-webapp.js"></script>

    <script>
      // VeriLens Secure WebApp using Clean SDK Architecture
      let veriLensApp = null;
      let sdkStatus = null;

      // Wait for all scripts to load with better error handling
      function waitForScripts() {
        return new Promise((resolve, reject) => {
          let attempts = 0;
          const maxAttempts = 100; // 10 seconds at 100ms intervals

          const checkInterval = setInterval(() => {
            attempts++;

            const servicesLoaded =
              typeof window.AntiTamperingService !== 'undefined' &&
              typeof window.DeviceSensorService !== 'undefined' &&
              typeof window.HardwareAttestationService !== 'undefined' &&
              typeof window.BlockchainService !== 'undefined' &&
              typeof window.SecureCameraAPI !== 'undefined';

            const sdkLoaded =
              typeof window.VeriLensSDK !== 'undefined' &&
              typeof window.VeriLensWebApp !== 'undefined' &&
              typeof window.SecurityManager !== 'undefined';

            if (attempts % 10 === 0) {
              // Log every second
              console.log(`üîç Loading check ${attempts}/${maxAttempts}:`, {
                AntiTamperingService: typeof window.AntiTamperingService,
                DeviceSensorService: typeof window.DeviceSensorService,
                HardwareAttestationService:
                  typeof window.HardwareAttestationService,
                BlockchainService: typeof window.BlockchainService,
                SecureCameraAPI: typeof window.SecureCameraAPI,
                VeriLensSDK: typeof window.VeriLensSDK,
                VeriLensWebApp: typeof window.VeriLensWebApp,
                SecurityManager: typeof window.SecurityManager,
              });
            }

            if (servicesLoaded && sdkLoaded) {
              clearInterval(checkInterval);
              console.log('‚úÖ All scripts loaded successfully!');
              resolve();
            } else if (attempts >= maxAttempts) {
              clearInterval(checkInterval);
              console.error('‚ùå Timeout waiting for scripts to load');
              reject(new Error('Timeout waiting for scripts to load'));
            }
          }, 100);
        });
      }

      // Initialize the application
      async function initializeApp() {
        try {
          updateStatus('üîÑ Loading VeriLens SDK...', 'info');
          console.log('[INFO] üîÑ Loading VeriLens SDK...');

          // Wait for SDK scripts to load
          await waitForScripts();

          // Initialize VeriLens WebApp (which uses SDK internally)
          console.log('[INFO] üöÄ Initializing VeriLens WebApp...');
          veriLensApp = new window.VeriLensWebApp({
            security: {
              enableAntiTampering: true,
              enableHardwareAttestation: true,
              enableSensorValidation: true,
              enableBlockchainVerification: true,
              securityLevel: 'maximum',
            },
            blockchain: {
              network: 'polygon',
              fallbackToLocal: true,
            },
            camera: {
              quality: 0.98,
              frameValidation: true,
              motionDetection: true,
              liveProofRequired: true,
            },
          });

          await veriLensApp.initialize();

          updateStatus(
            '‚úÖ VeriLens SDK Ready - All Security Services Active',
            'success'
          );

          // Get initial status
          sdkStatus = veriLensApp.getStatus();
          console.log('üìä SDK Status:', sdkStatus);
        } catch (error) {
          console.error('‚ùå Initialization failed:', error);
          updateStatus(
            `‚ùå SDK Initialization Failed: ${error.message}`,
            'error'
          );
        }
      }

      // Start secure camera using SDK
      async function startSecureCamera() {
        if (!veriLensApp) {
          updateStatus('‚ùå SDK not initialized', 'error');
          return;
        }

        try {
          updateStatus('üìπ Starting secure camera...', 'info');
          updateCameraOverlay('üîÑ Initializing secure capture...');

          // Use SDK's secure camera method
          await veriLensApp.startCamera();

          updateStatus(
            'üìπ Secure camera active with hardware validation',
            'success'
          );
          updateCameraOverlay('‚úÖ Secure Camera Active');

          // Enable capture button
          document.getElementById('capturePhoto').disabled = false;
        } catch (error) {
          console.error('‚ùå Camera start failed:', error);
          updateStatus(`‚ùå Secure camera failed: ${error.message}`, 'error');
          updateCameraOverlay('‚ùå Camera Error');
        }
      }

      // Capture photo using SDK with full security pipeline
      async function captureSecurePhoto() {
        if (!veriLensApp) {
          updateStatus('‚ùå SDK not initialized', 'error');
          return;
        }

        try {
          updateStatus('üì∏ Capturing secure photo with validation...', 'info');
          updateCameraOverlay('üì∏ Capturing with security validation...');

          // Use SDK's secure capture method (handles all security internally)
          const result = await veriLensApp.capturePhoto();

          if (result.success) {
            displayCaptureResults(result);
            updateStatus(
              `‚úÖ Photo captured with trust score: ${result.verification?.trustScore}/100`,
              'success'
            );
            updateCameraOverlay('‚úÖ Secure capture complete');
          } else {
            updateStatus(`‚ùå Capture failed: ${result.error}`, 'error');
            updateCameraOverlay('‚ùå Capture failed');
          }
        } catch (error) {
          console.error('‚ùå Secure capture failed:', error);
          updateStatus(`‚ùå Capture error: ${error.message}`, 'error');
          updateCameraOverlay('‚ùå Capture error');
        }
      }

      // Verify image hash using SDK
      async function verifyImageHash() {
        const hashInput = document.getElementById('hashInput');
        const hash = hashInput.value.trim();

        if (!hash || hash.length !== 64) {
          alert('Please enter a valid 64-character SHA-256 hash');
          return;
        }

        if (!veriLensApp) {
          updateStatus('‚ùå SDK not initialized', 'error');
          return;
        }

        try {
          updateStatus('üîç Verifying image hash...', 'info');

          // Use SDK's verification method
          const result = await veriLensApp.verifyImage(hash);

          displayVerificationResults(result, hash);

          if (result.verified) {
            updateStatus(
              `‚úÖ Image verified with trust score: ${result.trustScore}/100`,
              'success'
            );
          } else {
            updateStatus(
              '‚ùå Image not found or verification failed',
              'warning'
            );
          }
        } catch (error) {
          console.error('‚ùå Verification failed:', error);
          updateStatus(`‚ùå Verification error: ${error.message}`, 'error');
        }
      }

      // Get SDK status
      function getSDKStatus() {
        if (!veriLensApp) {
          updateStatus('‚ùå SDK not initialized', 'error');
          return;
        }

        const status = veriLensApp.getStatus();
        console.log('üìä Current SDK Status:', status);

        // Display status in results
        const resultsSection = document.getElementById('resultsSection');
        const resultsDiv = document.getElementById('captureResults');

        resultsDiv.innerHTML = `
                <div class="result-card">
                    <h3>üìä System Status</h3>
                    <div class="details-grid">
                        <div class="detail-item">
                            <h4>üîß SDK Status</h4>
                            <p><span class="status-indicator ${
                              status.initialized ? 'active' : 'inactive'
                            }"></span>
                               Initialized: ${
                                 status.initialized ? 'Yes' : 'No'
                               }</p>
                            <p>Services: ${status.servicesCount}</p>
                            <p>Security Level: ${
                              status.config?.security?.securityLevel ||
                              'Unknown'
                            }</p>
                        </div>
                        <div class="detail-item">
                            <h4>üõ°Ô∏è Security Services</h4>
                            <p><span class="status-indicator ${
                              status.security?.antiTampering === 'available'
                                ? 'active'
                                : 'inactive'
                            }"></span>
                               Anti-Tampering: ${
                                 status.security?.antiTampering || 'Unknown'
                               }</p>
                            <p><span class="status-indicator ${
                              status.security?.hardwareAttestation ===
                              'available'
                                ? 'active'
                                : 'inactive'
                            }"></span>
                               Hardware Attestation: ${
                                 status.security?.hardwareAttestation ||
                                 'Unknown'
                               }</p>
                            <p><span class="status-indicator ${
                              status.security?.deviceSensor === 'available'
                                ? 'active'
                                : 'inactive'
                            }"></span>
                               Device Sensors: ${
                                 status.security?.deviceSensor || 'Unknown'
                               }</p>
                            <p><span class="status-indicator ${
                              status.security?.blockchain === 'available'
                                ? 'active'
                                : 'inactive'
                            }"></span>
                               Blockchain: ${
                                 status.security?.blockchain || 'Unknown'
                               }</p>
                            <p><span class="status-indicator ${
                              status.security?.secureCamera === 'available'
                                ? 'active'
                                : 'inactive'
                            }"></span>
                               Secure Camera: ${
                                 status.security?.secureCamera || 'Unknown'
                               }</p>
                        </div>
                    </div>
                </div>
            `;

        resultsSection.style.display = 'block';
        updateStatus('üìä System status displayed', 'success');
      }

      // Global variable to store current result for download functions
      let currentCaptureResult = null;

      // Display capture results with enhanced UI
      function displayCaptureResults(result) {
        currentCaptureResult = result; // Store for download functions
        const resultsSection = document.getElementById('resultsSection');
        const resultsDiv = document.getElementById('captureResults');

        const trustScore = result.verification?.trustScore || 0;
        const trustClass =
          trustScore >= 80 ? 'high' : trustScore >= 60 ? 'medium' : 'low';

        const fullHash = result.image?.hash || 'No hash available';
        const imageSize = result.image?.blob
          ? Math.round(result.image.blob.size / 1024)
          : 0;
        const timestamp = new Date().toLocaleString();

        resultsDiv.innerHTML = `
                <div class="result-card success">
                    <div class="result-header">
                        <h3>‚úÖ Secure Photo Captured & Verified</h3>
                        <div class="action-buttons">
                            <button onclick="downloadImage()" class="btn btn-download">
                                üíæ Download Image
                            </button>
                            <button onclick="downloadMetadata()" class="btn btn-metadata">
                                üìÑ Export Metadata
                            </button>
                            <button onclick="copyHash()" class="btn btn-copy">
                                üìã Copy Hash
                            </button>
                        </div>
                    </div>
                    
                    <div class="trust-score-section">
                        <div class="trust-score ${trustClass}">
                            Trust Score: ${trustScore}/100
                        </div>
                        <div class="sdk-status">
                            üîí Secured by VeriLens SDK
                        </div>
                    </div>
                    
                    ${
                      result.image?.dataUrl
                        ? `
                        <div class="image-container">
                            <img src="${result.image.dataUrl}" alt="Captured Photo" class="captured-image" id="capturedImageDisplay">
                        </div>
                    `
                        : ''
                    }
                    
                    <div class="details-grid">
                        <div class="detail-item">
                            <h4>üì∏ Image Details</h4>
                            <div class="hash-display">
                                <label><strong>SHA-256 Hash:</strong></label>
                                <div class="hash-value" id="imageHash">${fullHash}</div>
                            </div>
                            <p><strong>Size:</strong> ${imageSize} KB</p>
                            <p><strong>Captured:</strong> ${timestamp}</p>
                            <p><strong>Format:</strong> ${
                              result.image?.mimeType || 'image/jpeg'
                            }</p>
                        </div>
                        
                        <div class="detail-item">
                            <h4>üìÑ Metadata</h4>
                            <p><strong>Device:</strong> ${
                              result.deviceAttestation?.deviceFingerprint?.substring(
                                0,
                                20
                              ) || 'Unknown'
                            }...</p>
                            <p><strong>Network:</strong> ${
                              result.verification?.network || 'local-fallback'
                            }</p>
                            <p><strong>Camera:</strong> Web Camera</p>
                            <p><strong>SDK Version:</strong> VeriLens 0.1.0</p>
                        </div>
                        
                        <div class="detail-item">
                            <h4>üîê Security Validation</h4>
                            <p><span class="status-indicator ${
                              result.security?.integrityPassed
                                ? 'active'
                                : 'inactive'
                            }"></span>
                               Integrity: ${
                                 result.security?.integrityPassed
                                   ? 'Passed'
                                   : 'Failed'
                               }</p>
                            <p><span class="status-indicator ${
                              !result.security?.tamperingDetected
                                ? 'active'
                                : 'inactive'
                            }"></span>
                               Tampering: ${
                                 result.security?.tamperingDetected
                                   ? 'Detected'
                                   : 'None'
                               }</p>
                            <p>Security Level: ${
                              result.verification?.securityLevel
                            }</p>
                        </div>
                        
                        <div class="detail-item">
                            <h4>‚õìÔ∏è Blockchain</h4>
                            <p><span class="status-indicator ${
                              result.blockchain?.verified
                                ? 'active'
                                : 'inactive'
                            }"></span>
                               Status: ${
                                 result.blockchain?.verified
                                   ? 'Verified'
                                   : 'Failed'
                               }</p>
                            <p>Network: ${result.blockchain?.network}</p>
                            <p>Hash: ${result.blockchain?.transactionHash?.substring(
                              0,
                              16
                            )}...</p>
                            <p>Timestamp: ${new Date(
                              result.blockchain?.timestamp
                            ).toLocaleString()}</p>
                        </div>
                        
                        <div class="detail-item">
                            <h4>üì± Device Attestation</h4>
                            <p>Trust Score: ${
                              result.verification?.trustScore
                            }/100</p>
                            <p>Device Validated: ${
                              result.verification?.deviceAttestation
                                ? 'Yes'
                                : 'No'
                            }</p>
                            <p>Sensors Active: ${
                              result.verification?.sensorData ? 'Yes' : 'No'
                            }</p>
                        </div>
                    </div>
                </div>
            `;

        resultsSection.style.display = 'block';
      }

      // Display verification results
      function displayVerificationResults(result, hash) {
        const verificationDiv = document.getElementById('verificationResults');

        const trustScore = result.trustScore || 0;
        const trustClass =
          trustScore >= 80 ? 'high' : trustScore >= 60 ? 'medium' : 'low';

        verificationDiv.innerHTML = `
                <div class="result-card ${
                  result.verified ? 'success' : 'warning'
                }">
                    <h3>${
                      result.verified
                        ? '‚úÖ Image Verified'
                        : '‚ùå Image Not Found'
                    }</h3>
                    
                    ${
                      result.verified
                        ? `
                        <div class="trust-score ${trustClass}">
                            Trust Score: ${trustScore}/100
                        </div>
                    `
                        : ''
                    }
                    
                    <div class="details-grid">
                        <div class="detail-item">
                            <h4>üîç Verification Details</h4>
                            <p>Hash: ${hash.substring(0, 16)}...</p>
                            <p><span class="status-indicator ${
                              result.exists ? 'active' : 'inactive'
                            }"></span>
                               Exists: ${result.exists ? 'Yes' : 'No'}</p>
                            <p><span class="status-indicator ${
                              result.verified ? 'active' : 'inactive'
                            }"></span>
                               Verified: ${result.verified ? 'Yes' : 'No'}</p>
                        </div>
                        
                        ${
                          result.verified
                            ? `
                            <div class="detail-item">
                                <h4>üìä Blockchain Data</h4>
                                <p>Timestamp: ${new Date(
                                  result.timestamp
                                ).toLocaleString()}</p>
                                <p>Device ID: ${result.deviceId?.substring(
                                  0,
                                  16
                                )}...</p>
                                <p>Network: ${result.network}</p>
                            </div>
                            
                            <div class="detail-item">
                                <h4>üîê Security Checks</h4>
                                <p><span class="status-indicator ${
                                  result.securityChecks?.codeIntegrity
                                    ? 'active'
                                    : 'inactive'
                                }"></span>
                                   Code Integrity: ${
                                     result.securityChecks?.codeIntegrity
                                       ? 'Passed'
                                       : 'Failed'
                                   }</p>
                                <p><span class="status-indicator ${
                                  result.securityChecks?.deviceValidation
                                    ? 'active'
                                    : 'inactive'
                                }"></span>
                                   Device Validation: ${
                                     result.securityChecks?.deviceValidation
                                       ? 'Passed'
                                       : 'Failed'
                                   }</p>
                                <p><span class="status-indicator ${
                                  result.securityChecks?.sensorValidation
                                    ? 'active'
                                    : 'inactive'
                                }"></span>
                                   Sensor Validation: ${
                                     result.securityChecks?.sensorValidation
                                       ? 'Passed'
                                       : 'Failed'
                                   }</p>
                            </div>
                        `
                            : ''
                        }
                    </div>
                </div>
            `;

        verificationDiv.style.display = 'block';
      }

      // Helper functions
      function updateStatus(message, type = 'info') {
        const statusDiv = document.getElementById('securityStatus');
        const statusText = document.getElementById('statusText');

        statusText.textContent = message;

        // Update styling based on type
        statusDiv.className = 'security-status';
        if (type === 'success') {
          statusDiv.classList.add('success');
        } else if (type === 'warning') {
          statusDiv.classList.add('warning');
        } else if (type === 'error') {
          statusDiv.classList.add('error');
        }

        console.log(`[${type.toUpperCase()}] ${message}`);
      }

      function updateCameraOverlay(text) {
        const overlayText = document.getElementById('overlayText');
        overlayText.textContent = text;
      }

      // Download and utility functions
      function downloadImage() {
        if (!currentCaptureResult?.image?.dataUrl) {
          alert('No image to download');
          return;
        }

        const link = document.createElement('a');
        link.download = `verilens-secure-photo-${Date.now()}.jpg`;
        link.href = currentCaptureResult.image.dataUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        updateStatus('üì• Image downloaded successfully', 'success');
      }

      function downloadMetadata() {
        if (!currentCaptureResult) {
          alert('No metadata to export');
          return;
        }

        const metadata = {
          hash: currentCaptureResult.image?.hash,
          size: currentCaptureResult.image?.blob?.size,
          timestamp: new Date().toISOString(),
          trustScore: currentCaptureResult.verification?.trustScore,
          deviceFingerprint:
            currentCaptureResult.deviceAttestation?.deviceFingerprint,
          network: currentCaptureResult.verification?.network,
          security: currentCaptureResult.security,
          sdk: 'VeriLens 0.1.0',
          verified: true,
        };

        const blob = new Blob([JSON.stringify(metadata, null, 2)], {
          type: 'application/json',
        });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.download = `verilens-metadata-${Date.now()}.json`;
        link.href = url;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        updateStatus('üìä Metadata exported successfully', 'success');
      }

      function copyHash() {
        const hash = currentCaptureResult?.image?.hash;
        if (!hash) {
          alert('No hash to copy');
          return;
        }

        navigator.clipboard
          .writeText(hash)
          .then(() => {
            updateStatus('üìã Hash copied to clipboard', 'success');
          })
          .catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = hash;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            updateStatus('üìã Hash copied to clipboard', 'success');
          });
      }

      // Test verification function
      async function testVerification() {
        const hashInput = document.getElementById('hashInput');
        const hash = hashInput.value.trim();

        if (!hash) {
          updateStatus('Please enter a hash to verify', 'warning');
          return;
        }

        if (hash.length !== 64) {
          updateStatus(
            'Invalid hash format. SHA-256 hashes are 64 characters long.',
            'error'
          );
          return;
        }

        try {
          updateStatus('üîç Verifying hash...', 'info');
          const result = await veriLensApp.verifyImage(hash);
          displayVerificationResults(result, hash);
        } catch (error) {
          console.error('Verification error:', error);
          updateStatus(`‚ùå Verification failed: ${error.message}`, 'error');
        }
      }

      // Initialize when page loads
      document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
  </body>
</html>
